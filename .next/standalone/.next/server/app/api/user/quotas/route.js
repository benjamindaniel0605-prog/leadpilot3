"use strict";(()=>{var e={};e.id=444,e.ids=[444],e.modules={2823:e=>{e.exports=require("@supabase/ssr")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5528:e=>{e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},1877:e=>{e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},5319:e=>{e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},6113:e=>{e.exports=require("crypto")},7147:e=>{e.exports=require("fs")},1808:e=>{e.exports=require("net")},2037:e=>{e.exports=require("os")},4074:e=>{e.exports=require("perf_hooks")},2781:e=>{e.exports=require("stream")},4404:e=>{e.exports=require("tls")},7231:(e,t,a)=>{a.r(t),a.d(t,{headerHooks:()=>A,originalPathname:()=>h,patchFetch:()=>v,requestAsyncStorage:()=>L,routeModule:()=>f,serverHooks:()=>g,staticGenerationAsyncStorage:()=>N,staticGenerationBailout:()=>y});var r={};a.r(r),a.d(r,{GET:()=>m,runtime:()=>_});var o=a(5419),l=a(9108),s=a(9678),d=a(8070),n=a(2823),i=a(2455),u=a(9568),c=a(2030),p=a(2279);let _="nodejs";async function m(e){try{let e=(0,i.cookies)(),t=(0,n.createServerClient)("https://ghuifzsvtjafmykroivw.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdodWlmenN2dGphZm15a3JvaXZ3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQyOTgxODUsImV4cCI6MjA2OTg3NDE4NX0.ekmuogfgI6VuewDIlGnOWUf_vVWhP0D4fn-Ukfel4rw",{cookies:{get:t=>e.get(t)?.value,set(t,a,r){e.set(t,a,r)},remove(t,a){e.set(t,"",{...a,maxAge:0})}}}),{data:{user:a},error:r}=await t.auth.getUser();if(r||!a)return d.Z.json({error:"Non authentifi\xe9"},{status:401});let{data:o}=await t.from("profiles").select("plan").eq("id",a.id).single(),l=o?.plan||"free",s=(e=>{switch(e){case"free":default:return{leads:5,variations:5};case"starter":return{leads:100,variations:100};case"pro":return{leads:400,variations:300};case"growth":return{leads:1500,variations:1e3}}})(l),_=new Date,m=new Date(_.getFullYear(),_.getMonth(),1),f=new Date(_.getFullYear(),_.getMonth()-1,1),L=await u.db.select({count:c.Rc.id}).from(c.Rc).where((0,p.xD)((0,p.eq)(c.Rc.userId,a.id),(0,p.eg)(c.Rc.createdAt,m))).then(e=>e.length),N=await u.db.select({count:c.Rc.id}).from(c.Rc).where((0,p.xD)((0,p.eq)(c.Rc.userId,a.id),(0,p.eg)(c.Rc.createdAt,f),(0,p.lt)(c.Rc.createdAt,m))).then(e=>e.length),g={plan:l,leadsUsed:L,leadsLimit:s.leads,variationsUsed:0,variationsLimit:s.variations,templatesAccessible:"free"===l?1:"starter"===l?5:"pro"===l?15:30,templatesLimit:30,leadsLastMonth:N,variationsLastMonth:0};return d.Z.json(g)}catch(e){return console.error("Erreur r\xe9cup\xe9ration quotas:",e),d.Z.json({error:"Erreur lors de la r\xe9cup\xe9ration des quotas"},{status:500})}}let f=new o.AppRouteRouteModule({definition:{kind:l.x.APP_ROUTE,page:"/api/user/quotas/route",pathname:"/api/user/quotas",filename:"route",bundlePath:"app/api/user/quotas/route"},resolvedPagePath:"C:\\Users\\benja\\Desktop\\LeadPilot SaaS\\LeadPilot\\app\\api\\user\\quotas\\route.ts",nextConfigOutput:"standalone",userland:r}),{requestAsyncStorage:L,staticGenerationAsyncStorage:N,serverHooks:g,headerHooks:A,staticGenerationBailout:y}=f,h="/api/user/quotas/route";function v(){return(0,s.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:N})}},9568:(e,t,a)=>{a.d(t,{db:()=>d});var r=a(1309),o=a(5669);let l=process.env.DATABASE_URL,s=(0,o.Z)(l),d=(0,r.t)(s)},2030:(e,t,a)=>{a.d(t,{Rc:()=>p,rC:()=>c});var r=a(2393),o=a(6155),l=a(1930),s=a(573),d=a(2561),n=a(6402),i=a(5887),u=a(6664);(0,o.af)("sessions",{sid:(0,l.L7)("sid").primaryKey(),sess:(0,s.JB)("sess").notNull(),expire:(0,d.AB)("expire").notNull()});let c=(0,o.af)("users",{id:(0,l.L7)("id").primaryKey().default(r.i6`gen_random_uuid()`),email:(0,l.L7)("email").unique(),firstName:(0,l.L7)("first_name"),lastName:(0,l.L7)("last_name"),profileImageUrl:(0,l.L7)("profile_image_url"),plan:(0,l.L7)("plan").notNull().default("free"),stripeCustomerId:(0,l.L7)("stripe_customer_id"),stripeSubscriptionId:(0,l.L7)("stripe_subscription_id"),leadsUsed:(0,n._L)("leads_used").notNull().default(0),aiVariationsUsed:(0,n._L)("ai_variations_used").notNull().default(0),variationHistory:(0,s.JB)("variation_history").default([]),googleEmailConnected:(0,i.O7)("google_email_connected").default(!1),googleEmailToken:(0,u.fL)("google_email_token"),googleRefreshToken:(0,u.fL)("google_refresh_token"),outlookEmailConnected:(0,i.O7)("outlook_email_connected").default(!1),outlookEmailToken:(0,u.fL)("outlook_email_token"),outlookRefreshToken:(0,u.fL)("outlook_refresh_token"),connectedEmailAddress:(0,l.L7)("connected_email_address"),createdAt:(0,d.AB)("created_at").defaultNow(),updatedAt:(0,d.AB)("updated_at").defaultNow()});(0,o.af)("templates",{id:(0,l.L7)("id").primaryKey().default(r.i6`gen_random_uuid()`),name:(0,l.L7)("name").notNull(),subject:(0,u.fL)("subject").notNull(),content:(0,u.fL)("content").notNull(),plan:(0,l.L7)("plan").notNull(),category:(0,l.L7)("category"),variables:(0,s.JB)("variables"),timesUsed:(0,n._L)("times_used").notNull().default(0),openRate:(0,n._L)("open_rate").default(0),createdAt:(0,d.AB)("created_at").defaultNow()});let p=(0,o.af)("leads",{id:(0,l.L7)("id").primaryKey().default(r.i6`gen_random_uuid()`),userId:(0,l.L7)("user_id").notNull().references(()=>c.id),firstName:(0,l.L7)("first_name").notNull(),lastName:(0,l.L7)("last_name").notNull(),email:(0,l.L7)("email").notNull(),company:(0,l.L7)("company").notNull(),sector:(0,l.L7)("sector"),position:(0,l.L7)("position"),aiScore:(0,n._L)("ai_score"),status:(0,l.L7)("status").notNull().default("new"),source:(0,l.L7)("source").default("external"),notes:(0,u.fL)("notes"),createdAt:(0,d.AB)("created_at").defaultNow(),updatedAt:(0,d.AB)("updated_at").defaultNow()}),_=(0,o.af)("custom_emails",{id:(0,l.L7)("id").primaryKey().default(r.i6`gen_random_uuid()`),userId:(0,l.L7)("user_id").notNull(),name:(0,l.L7)("name").notNull(),subject:(0,u.fL)("subject").notNull(),content:(0,u.fL)("content").notNull(),baseTemplateId:(0,l.L7)("base_template_id"),createdAt:(0,d.AB)("created_at").defaultNow(),updatedAt:(0,d.AB)("updated_at").defaultNow()}),m=(0,o.af)("campaigns",{id:(0,l.L7)("id").primaryKey().default(r.i6`gen_random_uuid()`),userId:(0,l.L7)("user_id").notNull().references(()=>c.id),name:(0,l.L7)("name").notNull(),emailId:(0,l.L7)("email_id").notNull().references(()=>_.id),leadTargets:(0,l.L7)("lead_targets").notNull(),status:(0,l.L7)("status").notNull().default("draft"),totalSent:(0,n._L)("total_sent").notNull().default(0),totalOpened:(0,n._L)("total_opened").notNull().default(0),totalClicked:(0,n._L)("total_clicked").notNull().default(0),totalReplied:(0,n._L)("total_replied").notNull().default(0),scheduledAt:(0,d.AB)("scheduled_at"),createdAt:(0,d.AB)("created_at").defaultNow(),updatedAt:(0,d.AB)("updated_at").defaultNow()});(0,o.af)("campaign_emails",{id:(0,l.L7)("id").primaryKey().default(r.i6`gen_random_uuid()`),campaignId:(0,l.L7)("campaign_id").notNull().references(()=>m.id),leadId:(0,l.L7)("lead_id").notNull().references(()=>p.id),status:(0,l.L7)("status").notNull().default("pending"),sentAt:(0,d.AB)("sent_at"),openedAt:(0,d.AB)("opened_at"),clickedAt:(0,d.AB)("clicked_at"),repliedAt:(0,d.AB)("replied_at"),createdAt:(0,d.AB)("created_at").defaultNow()});let f=(0,o.af)("sequences",{id:(0,l.L7)("id").primaryKey().default(r.i6`gen_random_uuid()`),userId:(0,l.L7)("user_id").notNull().references(()=>c.id),name:(0,l.L7)("name").notNull(),description:(0,u.fL)("description"),status:(0,l.L7)("status").notNull().default("active"),createdAt:(0,d.AB)("created_at").defaultNow(),updatedAt:(0,d.AB)("updated_at").defaultNow()});(0,o.af)("sequence_steps",{id:(0,l.L7)("id").primaryKey().default(r.i6`gen_random_uuid()`),sequenceId:(0,l.L7)("sequence_id").notNull().references(()=>f.id,{onDelete:"cascade"}),stepOrder:(0,n._L)("step_order").notNull(),delayDays:(0,n._L)("delay_days").notNull().default(0),delayHours:(0,n._L)("delay_hours").notNull().default(0),emailTemplateId:(0,l.L7)("email_template_id").references(()=>_.id),subject:(0,l.L7)("subject"),content:(0,u.fL)("content"),createdAt:(0,d.AB)("created_at").defaultNow()}),(0,o.af)("sequence_enrollments",{id:(0,l.L7)("id").primaryKey().default(r.i6`gen_random_uuid()`),sequenceId:(0,l.L7)("sequence_id").notNull().references(()=>f.id,{onDelete:"cascade"}),leadId:(0,l.L7)("lead_id").notNull().references(()=>p.id),status:(0,l.L7)("status").notNull().default("active"),currentStep:(0,n._L)("current_step").notNull().default(0),nextSendAt:(0,d.AB)("next_send_at"),completedAt:(0,d.AB)("completed_at"),createdAt:(0,d.AB)("created_at").defaultNow(),updatedAt:(0,d.AB)("updated_at").defaultNow()}),(0,o.af)("bookings",{id:(0,l.L7)("id").primaryKey().default(r.i6`gen_random_uuid()`),userId:(0,l.L7)("user_id").notNull().references(()=>c.id),leadId:(0,l.L7)("lead_id").references(()=>p.id),title:(0,l.L7)("title").notNull(),description:(0,u.fL)("description"),startTime:(0,d.AB)("start_time").notNull(),endTime:(0,d.AB)("end_time").notNull(),status:(0,l.L7)("status").notNull().default("scheduled"),meetingType:(0,l.L7)("meeting_type").default("video"),conversionStatus:(0,l.L7)("conversion_status"),contactName:(0,l.L7)("contact_name"),contactEmail:(0,l.L7)("contact_email"),contactPhone:(0,l.L7)("contact_phone"),company:(0,l.L7)("company"),createdAt:(0,d.AB)("created_at").defaultNow()})}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[638,206,455,866],()=>a(7231));module.exports=r})();