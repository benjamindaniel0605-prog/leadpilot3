"use strict";(()=>{var e={};e.id=157,e.ids=[157],e.modules={2823:e=>{e.exports=require("@supabase/ssr")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},914:(e,r,o)=>{o.r(r),o.d(r,{headerHooks:()=>m,originalPathname:()=>_,patchFetch:()=>w,requestAsyncStorage:()=>g,routeModule:()=>d,serverHooks:()=>p,staticGenerationAsyncStorage:()=>h,staticGenerationBailout:()=>f});var t={};o.r(t),o.d(t,{GET:()=>c,runtime:()=>u});var a=o(5419),n=o(9108),i=o(9678),s=o(8070),l=o(2823);let u="nodejs";async function c(e){try{let{searchParams:r}=new URL(e.url),o=r.get("code"),t=r.get("state")||"/settings",a=r.get("error");if(a)return console.log("❌ Utilisateur a annul\xe9 l'autorisation Google:",a),s.Z.redirect(new URL(`${t}?error=oauth_cancelled`,e.url));if(!o)return console.error("❌ Code d'autorisation manquant dans la r\xe9ponse Google"),s.Z.redirect(new URL(`${t}?error=oauth_code_missing`,e.url));let n=process.env.GOOGLE_CLIENT_ID,i=process.env.GOOGLE_CLIENT_SECRET,u=`${process.env.NEXT_PUBLIC_SITE_URL}/api/oauth/google/callback`;if(!n||!i)return console.error("❌ Configuration Google OAuth manquante"),s.Z.redirect(new URL(`${t}?error=oauth_config_missing`,e.url));let c=await fetch("https://oauth2.googleapis.com/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({client_id:n,client_secret:i,code:o,grant_type:"authorization_code",redirect_uri:u})});if(!c.ok){let r=await c.text();return console.error("❌ Erreur lors de l'\xe9change du code:",r),s.Z.redirect(new URL(`${t}?error=oauth_token_exchange_failed`,e.url))}let{access_token:d,refresh_token:g,expires_in:h}=await c.json(),p=await fetch("https://www.googleapis.com/oauth2/v2/userinfo",{headers:{Authorization:`Bearer ${d}`}});if(!p.ok)return console.error("❌ Erreur lors de la r\xe9cup\xe9ration des infos utilisateur"),s.Z.redirect(new URL(`${t}?error=oauth_user_info_failed`,e.url));let m=await p.json(),f=(0,l.createServerClient)("https://ghuifzsvtjafmykroivw.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdodWlmenN2dGphZm15a3JvaXZ3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQyOTgxODUsImV4cCI6MjA2OTg3NDE4NX0.ekmuogfgI6VuewDIlGnOWUf_vVWhP0D4fn-Ukfel4rw",{cookies:{get:r=>e.cookies.get(r)?.value,set(e,r,o){},remove(e,r){}}}),{data:{user:_},error:w}=await f.auth.getUser();if(w||!_)return console.error("❌ Utilisateur non authentifi\xe9:",w),s.Z.redirect(new URL("/login?error=not_authenticated",e.url));return console.log("✅ OAuth Google r\xe9ussi pour:",m.email),console.log("\uD83D\uDCE7 Access Token:",d?"Pr\xe9sent":"Manquant"),console.log("\uD83D\uDD04 Refresh Token:",g?"Pr\xe9sent":"Manquant"),console.log("⏰ Expires in:",h,"secondes"),s.Z.redirect(new URL(`${t}?success=oauth_connected&email=${m.email}`,e.url))}catch(r){return console.error("❌ Erreur lors du callback OAuth Google:",r),s.Z.redirect(new URL("/settings?error=oauth_callback_failed",e.url))}}let d=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/oauth/google/callback/route",pathname:"/api/oauth/google/callback",filename:"route",bundlePath:"app/api/oauth/google/callback/route"},resolvedPagePath:"C:\\Users\\benja\\Desktop\\LeadPilot SaaS\\LeadPilot\\app\\api\\oauth\\google\\callback\\route.ts",nextConfigOutput:"standalone",userland:t}),{requestAsyncStorage:g,staticGenerationAsyncStorage:h,serverHooks:p,headerHooks:m,staticGenerationBailout:f}=d,_="/api/oauth/google/callback/route";function w(){return(0,i.patchFetch)({serverHooks:p,staticGenerationAsyncStorage:h})}}};var r=require("../../../../../webpack-runtime.js");r.C(e);var o=e=>r(r.s=e),t=r.X(0,[638,206],()=>o(914));module.exports=t})();